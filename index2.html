<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>–ß–∏-–§–∞–Ω—å ‚Äî —É–ª–∏—á–Ω–∞—è –∞–∑–∏–∞—Ç—Å–∫–∞—è –∫—É—Ö–Ω—è</title>
  <script src="https://api-maps.yandex.ru/2.1/?apikey=–í–ê–®_API_–ö–õ–Æ–ß&lang=ru_RU" type="text/javascript"></script>
  <script src="https://telegram.org/js/telegram-web-app.js"></script>
  
  <style>
    body, html { 
      margin:0; 
      padding:0; 
      height:100%; 
      background:#ffffff; 
      color:#000000; 
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; 
    }
    .container { 
      padding: 20px 16px; 
      max-width: 480px; 
      margin: 0 auto; 
    }
    .header { 
      text-align:center; 
      padding: 40px 0 30px; 
    }
    .logo { 
      width: 90px; 
      height: 90px; 
      border-radius: 50%; 
      border: 3px solid #000; 
      object-fit: cover; 
    }
    h1 { 
      font-size: 36px; 
      margin: 20px 0 8px; 
      font-weight: bold; 
    }
    .subtitle { 
      font-size: 16px; 
      line-height: 1.5; 
      margin-bottom: 30px; 
      color: #333; 
    }
    .btn-big { 
      display: block; 
      color:#000; 
      padding: 20px; 
      margin: 20px 0; 
      border-radius: 16px; 
      text-align: center; 
      font-size: 20px; 
      font-weight: bold; 
      text-decoration: none; 
      cursor: pointer; 
      border: none; 
      box-shadow: 0 4px 12px rgba(0,0,0,0.3);
    }
    .btn-big:disabled { 
      opacity: 0.55; 
      cursor: not-allowed; 
    }
    .btn-outline { 
      background:#fff; 
      color:#000; 
      border: 2px solid #000; 
    }
    .card { 
      background:#f8f8f8; 
      border-radius: 16px; 
      padding: 24px; 
      margin: 24px 0; 
      border: 1px solid #eee; 
    }
    .card h2 { 
      margin: 0 0 20px; 
      font-size: 22px; 
      font-weight: bold; 
      text-align: center; 
    }
    .branch { 
      padding: 16px 0; 
      border-bottom: 1px solid #ddd; 
    }
    .branch:last-child { 
      border-bottom: none; 
    }
    .branch-name { 
      font-size: 18px; 
      font-weight: bold; 
      margin-bottom: 6px; 
    }
    .branch-type { 
      font-size: 15px; 
      color: #000; 
      margin-bottom: 8px; 
      font-weight: 600; 
    }
    .branch-row { 
      display: flex; 
      align-items: center; 
      gap: 10px; 
      font-size: 15px; 
      color: #333; 
      margin: 8px 0; 
    }
    .icon { 
      font-size: 18px; 
    }
    .socials { 
      display: flex; 
      justify-content: center; 
      gap: 32px; 
      margin: 40px 0; 
    }
    .socials img { 
      width: 48px; 
      height: 48px; 
    }
    .apps { 
      display: flex; 
      justify-content: center; 
      gap: 24px; 
      margin: 30px 0; 
    }
    .apps img { 
      height: 56px; 
    }
    .faq { 
      line-height: 1.8; 
      font-size: 15px; 
    }
    .faq b { 
      display: block; 
      margin: 16px 0 8px; 
      font-size: 16px; 
    }
    .footer { 
      text-align: center; 
      padding: 50px 0 20px; 
      color: #666; 
      font-size: 14px; 
    }
    
    /* –ì–æ–ª–æ—Å–æ–≤–∞–Ω–∏–µ */
    .voting-card {
      background: linear-gradient(135deg, #e4263f, #e4263f);
      color: white;
      border: none;
      box-shadow: 0 6px 20px rgba(255,0,0,0.45);
    }
    .voting-card #results,
    .voting-card #user-message {
      color: white;
      text-shadow: 1px 1px 4px rgba(0,0,0,0.7);
    }

    /* –¢–∞–π–º–µ—Ä */
    .voting-timer {
      background: rgba(0,0,0,0.35);
      border-radius: 12px;
      padding: 16px;
      margin: 20px 0;
      text-align: center;
    }
    .timer-title {
      font-size: 16px;
      font-weight: bold;
      margin-bottom: 12px;
    }
    .timer-container {
      display: flex;
      justify-content: center;
      gap: 12px;
    }
    .time-unit {
      display: flex;
      flex-direction: column;
      align-items: center;
      min-width: 60px;
    }
    .time-value {
      font-size: 28px;
      font-weight: bold;
      background: rgba(255,255,255,0.22);
      padding: 8px 12px;
      border-radius: 8px;
      width: 100%;
      box-sizing: border-box;
    }
    .time-label {
      font-size: 12px;
      margin-top: 4px;
      text-transform: uppercase;
    }
    .timer-expired {
      font-size: 18px;
      font-weight: bold;
      color: #ffeb3b;
    }
  </style>
</head>
<body>
<div class="container">
  <div class="header">
    <img src="logo.jpg" alt="–ß–∏-–§–∞–Ω—å" class="logo">
    <h1>–ß–∏-–§–∞–Ω—å</h1>
    <p class="subtitle">–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ ¬´–ß–∏-–§–∞–Ω—å¬ª ‚Äî —Å–µ—Ç—å –∫–∞—Ñ–µ —É–ª–∏—á–Ω–æ–π –∞–∑–∏–∞—Ç—Å–∫–æ–π –∫—É—Ö–Ω–∏ –≤–æ –í–ª–∞–¥–∏–≤–æ—Å—Ç–æ–∫–µ.<br>–õ–∞–ø—à–∞, —Ä–∏—Å, —Å—É–ø—ã, —Å–∞–ª–∞—Ç—ã –∏ –º–Ω–æ–≥–æ–µ –¥—Ä—É–≥–æ–µ ‚Äî —Å –¥–æ—Å—Ç–∞–≤–∫–æ–π –∏–ª–∏ –≤ –Ω–∞—à–∏—Ö –∫–∞—Ñ–µ.</p>
  </div>

  <!-- –ì–æ–ª–æ—Å–æ–≤–∞–Ω–∏–µ -->
  <div class="card voting-card">
    <h2 style="margin: 0 0 20px; font-size: 28px; text-shadow: 2px 2px 4px rgba(0,0,0,0.6);">–Ø–ú–´ –°–´–†–ù–´–ô –ö–ê–†–†–ò üò≠üßÄüî•</h2>
    
    <p style="font-size: 17px; line-height: 1.5; margin: 0 0 24px; text-shadow: 1px 1px 3px rgba(0,0,0,0.7);">
      –î—Ä—É–∑—å—è, –ø—Ä—è–º–æ —Å–µ–π—á–∞—Å —Ä–µ—à–∞–µ—Ç—Å—è —Å—É–¥—å–±–∞ –Ω–∞—à–µ–≥–æ –∑–∏–º–Ω–µ–≥–æ —Ö–∏—Ç–∞ ‚Äî <strong>—Å—ã—Ä–Ω–æ–≥–æ –∫–∞—Ä—Ä–∏</strong>!<br>
      –ú—ã –µ–ª–∏ –µ–≥–æ –≤–µ—Å—å –¥–µ–∫–∞–±—Ä—å, –∞ —Ç–µ–ø–µ—Ä—å —à–µ—Ñ –≤–µ—Ä–æ–ª–æ–º–Ω–æ —Ö–æ—á–µ—Ç —É–±—Ä–∞—Ç—å –µ–≥–æ –∏–∑ –º–µ–Ω—é...
    </p>
    
    <p style="font-size: 19px; font-weight: bold; margin: 0 0 24px; text-shadow: 1px 1px 3px rgba(0,0,0,0.7);">
      –°—É–¥—å–±–∞ —Å—ã—Ä–Ω–æ–≥–æ –∫–∞—Ä—Ä–∏ –∑–∞–≤–∏—Å–∏—Ç –¢–û–õ–¨–ö–û –û–¢ –í–ê–°!
    </p>

    <!-- –¢–∞–π–º–µ—Ä -->
    <div id="voting-timer" class="voting-timer">
      <div class="timer-title">–ì–æ–ª–æ—Å–æ–≤–∞–Ω–∏–µ –∑–∞–≤–µ—Ä—à–∏—Ç—Å—è 20 —è–Ω–≤–∞—Ä—è –≤ 15:00 (–í–ª–∞–¥–∏–≤–æ—Å—Ç–æ–∫)</div>
      <div class="timer-container">
        <div class="time-unit">
          <div class="time-value" id="days">00</div>
          <div class="time-label">–î–Ω–µ–π</div>
        </div>
        <div class="time-unit">
          <div class="time-value" id="hours">00</div>
          <div class="time-label">–ß–∞—Å–æ–≤</div>
        </div>
        <div class="time-unit">
          <div class="time-value" id="minutes">00</div>
          <div class="time-label">–ú–∏–Ω—É—Ç</div>
        </div>
        <div class="time-unit">
          <div class="time-value" id="seconds">00</div>
          <div class="time-label">–°–µ–∫—É–Ω–¥</div>
        </div>
      </div>
    </div>

    <div style="display: flex; flex-direction: column; gap: 18px; align-items: center; margin-top: 20px;">
      <button id="vote-yes" class="btn-big" style="background: #ffdd00;">
        –û—Å—Ç–∞–≤–∏—Ç—å —Å—ã—Ä–Ω—ã–π –∫–∞—Ä—Ä–∏ –≤ –º–µ–Ω—é ‚ù§Ô∏è
      </button>
      
      <button id="vote-no" class="btn-big" style="background: #ffb300;">
        –£–±—Ä–∞—Ç—å —Å—ã—Ä–Ω—ã–π –∫–∞—Ä—Ä–∏ –∏–∑ –º–µ–Ω—é üò¢
      </button>
    </div>

    <p id="results" style="margin-top: 28px; font-size: 22px; font-weight: bold; text-align: center;">
      –ó–∞–≥—Ä—É–∑–∫–∞ –≥–æ–ª–æ—Å–æ–≤...
    </p>

    <p id="user-message" style="margin-top: 16px; font-size: 16px; text-align: center;"></p>
  </div>

  <a href="https://momchifan.ru/" class="btn-big">–ó–∞–∫–∞–∑–∞—Ç—å</a>
  <a href="https://t.me/momchifan" class="btn-big btn-outline">–ù–∞–ø–∏—Å–∞—Ç—å –≤ —á–∞—Ç</a>

  <div class="card">
    <h2>–ù–∞—à–∏ —Ñ–∏–ª–∏–∞–ª—ã</h2>
    <!-- ... (–≤—Å–µ —Ñ–∏–ª–∏–∞–ª—ã –æ—Å—Ç–∞—é—Ç—Å—è –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π) ... -->
    <div class="branch"><div class="branch-name">–ß–∏-–§–∞–Ω—å –Ω–∞ –°–∏–±–∏—Ä—Ü–µ–≤–∞</div><div class="branch-type">–ê–≤—Ç–æ–∫–∞—Ñ–µ</div><div class="branch-row"><span class="icon">üïí</span> –ü–Ω‚Äì–í—Å: 10:00 ‚Äì 03:00</div><div class="branch-row"><span class="icon">üìç</span> —É–ª. –í—Å–µ–≤–æ–ª–æ–¥–∞ –°–∏–±–∏—Ä—Ü–µ–≤–∞, –¥. 59, —Å—Ç. 2</div><div class="branch-row"><span class="icon">üöó</span> –ü–∞—Ä–∫–æ–≤–∫–∞</div></div>
    <div class="branch"><div class="branch-name">–ß–∏-–§–∞–Ω—å –Ω–∞ –ö–∞–ª–∏–Ω–∏–Ω–∞</div><div class="branch-type">–ö–∞—Ñ–µ</div><div class="branch-row"><span class="icon">üïí</span> –ü–Ω‚Äì–í—Å: 10:00 ‚Äì 21:00</div><div class="branch-row"><span class="icon">üìç</span> —É–ª. –ö–∞–ª–∏–Ω–∏–Ω–∞, 275–∞</div><div class="branch-row"><span class="icon">üöó</span> –ü–∞—Ä–∫–æ–≤–∫–∞</div></div>
    <div class="branch"><div class="branch-name">–ß–∏-–§–∞–Ω—å –Ω–∞ –°–≤–µ—Ç–ª–∞–Ω—Å–∫–æ–π</div><div class="branch-type">–ö–∞—Ñ–µ</div><div class="branch-row"><span class="icon">üïí</span> –ü–Ω‚Äì–í—Å: 10:00 ‚Äì 22:00</div><div class="branch-row"><span class="icon">üìç</span> —É–ª. –°–≤–µ—Ç–ª–∞–Ω—Å–∫–∞—è, 9–±</div><div class="branch-row"><span class="icon">üöó</span> –ü–∞—Ä–∫–æ–≤–∫–∞</div></div>
    <div class="branch"><div class="branch-name">–ß–∏-–§–∞–Ω—å –Ω–∞ –¢–æ–±–æ–ª—å—Å–∫–æ–π</div><div class="branch-type">–ê–≤—Ç–æ–∫–∞—Ñ–µ</div><div class="branch-row"><span class="icon">üïí</span> –ü–Ω‚Äì–í—Å: 10:00 ‚Äì 00:00</div><div class="branch-row"><span class="icon">üìç</span> —É–ª. –¢–æ–±–æ–ª—å—Å–∫–∞—è, –¥. 10, —Å—Ç. 2</div><div class="branch-row"><span class="icon">üöó</span> –ü–∞—Ä–∫–æ–≤–∫–∞</div></div>
    <div class="branch"><div class="branch-name">–ß–∏-–§–∞–Ω—å –Ω–∞ –î–æ–±—Ä–æ–≤–æ–ª—å—Å–∫–æ–≥–æ</div><div class="branch-type">–ö–∞—Ñ–µ</div><div class="branch-row"><span class="icon">üïí</span> –ü–Ω‚Äì–í—Å: 10:00 ‚Äì 23:00</div><div class="branch-row"><span class="icon">üìç</span> —É–ª. –î–æ–±—Ä–æ–≤–æ–ª—å—Å–∫–æ–≥–æ, 5–∞ —Å—Ç1 (–∫–∏–æ—Å–∫)</div></div>
  </div>

  <div id="map" style="width: 100%; height: 400px; margin: 24px 0; border-radius: 16px; border: 1px solid #eee;"></div>

  <div class="card"><h2>–ö–æ–Ω—Ç–∞–∫—Ç—ã</h2><p style="text-align:center;font-size:20px;font-weight:bold;">+7 (800) 201-55-29</p></div>

  <div class="socials">
    <a href="https://instagram.com/mom_chifan" target="_blank"><img src="ig.png" alt="Instagram"></a>
    <a href="https://t.me/momchifan" target="_blank"><img src="tg.png" alt="Telegram"></a>
    <a href="https://vk.com/mom_chifan" target="_blank"><img src="vk.png" alt="VK"></a>
    <a href="https://wa.me/79662798365" target="_blank"><img src="wa.png" alt="WhatsApp"></a>
  </div>

  <div class="apps">
    <a href="https://apps.apple.com/us/app/%D1%87%D0%B8-%D1%84%D0%B0%D0%BD%D1%8C/id1607510961" target="_blank"><img src="appstore.png" alt="App Store"></a>
    <a href="https://play.google.com/store/apps/details?id=com.rubeacon.chifan" target="_blank"><img src="googleplay.png" alt="Google Play"></a>
  </div>

  <div class="card">
    <h2>–ß–∞—Å—Ç—ã–µ –≤–æ–ø—Ä–æ—Å—ã</h2>
    <div class="faq">
      <b>1. –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∞—è –ø–æ–¥–¥–µ—Ä–∂–∫–∞</b><br>–ü—Ä–æ–±–ª–µ–º—ã —Å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ–º –∏–ª–∏ —Å–∞–π—Ç–æ–º ‚Äî –ø–∏—à–∏—Ç–µ –≤ —Ç–µ–ª–µ–≥—Ä–∞–º–º: <a href="https://t.me/momchifan">@momchifan</a><br><br>
      <b>2. –ö–∞–∫ –æ–ø–ª–∞—Ç–∏—Ç—å –∑–∞–∫–∞–∑?</b><br>–ë–∞–Ω–∫–æ–≤—Å–∫–æ–π –∫–∞—Ä—Ç–æ–π. –ö–∞—Ä—Ç–∞ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –¥–ª—è —Å–ª–µ–¥—É—é—â–∏—Ö –∑–∞–∫–∞–∑–æ–≤ (–º–æ–∂–Ω–æ —É–¥–∞–ª–∏—Ç—å/—Å–º–µ–Ω–∏—Ç—å –≤ –ø—Ä–æ—Ñ–∏–ª–µ).<br><br>
      <b>3. –ö–∞—Ä—Ç–∞ –¥–æ—Å—Ç–∞–≤–∫–∏</b><br>–°–æ–±—Å—Ç–≤–µ–Ω–Ω–∞—è –¥–æ—Å—Ç–∞–≤–∫–∞, –Ω–µ –≤–æ –≤—Å–µ —Ä–∞–π–æ–Ω—ã. –í–≤–µ–¥–∏—Ç–µ –∞–¥—Ä–µ—Å ‚Äî —É–≤–∏–¥–∏—Ç–µ —Å—Ç–æ–∏–º–æ—Å—Ç—å –∏ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å.<br><br>
      <b>4. –ö–∞–∫ —É–¥–∞–ª–∏—Ç—å –∞–∫–∫–∞—É–Ω—Ç</b><br>–ü—Ä–æ—Ñ–∏–ª—å ‚Üí –ú–æ–∏ –¥–∞–Ω–Ω—ã–µ ‚Üí –£–¥–∞–ª–∏—Ç—å –∞–∫–∫–∞—É–Ω—Ç ‚Üí ¬´–•–æ—á—É —É–¥–∞–ª–∏—Ç—å –Ω–∞–≤—Å–µ–≥–¥–∞¬ª (–Ω–µ–æ–±—Ä–∞—Ç–∏–º–æ).
    </div>
  </div>

  <div class="footer">–ß–∏-–§–∞–Ω—å ‚Äî –µ–¥–∞, –∫–æ—Ç–æ—Ä–∞—è –≤–¥–æ—Ö–Ω–æ–≤–ª—è–µ—Ç<br>–í–ª–∞–¥–∏–≤–æ—Å—Ç–æ–∫ ¬© 2025</div>
</div>

<script>
// === –ù–∞—Å—Ç—Ä–æ–π–∫–∏ GitHub ===
const GITHUB = {
  owner: 'wwwgolybfs-dev',
  repo: 'HelpChifanbot',
  path: 'votes.json',
  token: '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' 
};

const YES = 'yes';
const NO = 'no';

// –î–µ–¥–ª–∞–π–Ω: 20 —è–Ω–≤–∞—Ä—è 2026 15:00 VLAT ‚Üí 05:00 UTC
const DEADLINE = new Date('2026-01-20T05:00:00Z').getTime();

// Telegram User ID
let userId = null;
if (window.Telegram?.WebApp?.initDataUnsafe?.user?.id) {
  userId = window.Telegram.WebApp.initDataUnsafe.user.id.toString();
} else {
  document.getElementById('user-message').textContent = '–ó–∞–ø—É—Å—Ç–∏—Ç–µ –≤ Telegram –¥–ª—è —É—á–∞—Å—Ç–∏—è –≤ –≥–æ–ª–æ—Å–æ–≤–∞–Ω–∏–∏';
}

// =============================================
// –¢–∞–π–º–µ—Ä
function updateTimer() {
  const now = Date.now();
  const distance = DEADLINE - now;

  if (distance <= 0) {
    document.getElementById('voting-timer').innerHTML = '<div class="timer-expired">–ì–æ–ª–æ—Å–æ–≤–∞–Ω–∏–µ –∑–∞–≤–µ—Ä—à–µ–Ω–æ!</div>';
    disableButtons();
    document.getElementById('user-message').textContent = '–ì–æ–ª–æ—Å–æ–≤–∞–Ω–∏–µ –∑–∞–∫—Ä—ã—Ç–æ';
    return;
  }

  const days    = Math.floor(distance / (1000 * 60 * 60 * 24));
  const hours   = Math.floor((distance % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
  const minutes = Math.floor((distance % (1000 * 60 * 60)) / (1000 * 60));
  const seconds = Math.floor((distance % (1000 * 60)) / 1000);

  document.getElementById('days').textContent    = days.toString().padStart(2, '0');
  document.getElementById('hours').textContent   = hours.toString().padStart(2, '0');
  document.getElementById('minutes').textContent = minutes.toString().padStart(2, '0');
  document.getElementById('seconds').textContent = seconds.toString().padStart(2, '0');
}

// =============================================
// –ó–∞–≥—Ä—É–∑–∫–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
async function loadResults() {
  try {
    const res = await fetch(`https://api.github.com/repos/${GITHUB.owner}/${GITHUB.repo}/contents/${GITHUB.path}`, {
      headers: { 'Authorization': `token ${GITHUB.token}` }
    });

    if (!res.ok) {
      if (res.status === 404) {
        document.getElementById('results').textContent = '–§–∞–π–ª –≥–æ–ª–æ—Å–æ–≤–∞–Ω–∏—è –Ω–µ –Ω–∞–π–¥–µ–Ω –Ω–∞ GitHub üò¢';
      } else if (res.status === 401 || res.status === 403) {
        document.getElementById('results').textContent = '–û—à–∏–±–∫–∞ –¥–æ—Å—Ç—É–ø–∞ –∫ GitHub (—Ç–æ–∫–µ–Ω?)';
      } else {
        document.getElementById('results').textContent = `–û—à–∏–±–∫–∞ GitHub API: ${res.status}`;
      }
      throw new Error(`GitHub error: ${res.status}`);
    }

    const data = await res.json();

    if (!data.content) {
      throw new Error('–ü–æ–ª–µ content –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç –≤ –æ—Ç–≤–µ—Ç–µ GitHub');
    }

    let base64Content = data.content.replace(/\s+/g, '');
    const votes = JSON.parse(atob(base64Content));

    document.getElementById('results').textContent = `–ó–∞ –æ—Å—Ç–∞–≤–∏—Ç—å: ${votes.yes || 0} ‚Ä¢ –ü—Ä–æ—Ç–∏–≤: ${votes.no || 0}`;

    if (userId && votes.voters?.[userId]) {
      const text = votes.voters[userId] === YES ? '–∑–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ' : '–∑–∞ —É–¥–∞–ª–µ–Ω–∏–µ';
      document.getElementById('user-message').textContent = `–í—ã —É–∂–µ –≥–æ–ª–æ—Å–æ–≤–∞–ª–∏ ${text}`;
      disableButtons();
    }
  } catch (e) {
    console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏:', e);
    document.getElementById('results').textContent = '–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –≥–æ–ª–æ—Å–æ–≤ üòî';
  }
}

// –ì–æ–ª–æ—Å–æ–≤–∞–Ω–∏–µ
async function vote(choice) {
  if (Date.now() >= DEADLINE) {
    alert('–ì–æ–ª–æ—Å–æ–≤–∞–Ω–∏–µ –∑–∞–≤–µ—Ä—à–µ–Ω–æ!');
    return;
  }

  if (!userId) {
    alert('–ì–æ–ª–æ—Å–æ–≤–∞–Ω–∏–µ –¥–æ—Å—Ç—É–ø–Ω–æ —Ç–æ–ª—å–∫–æ –≤ Telegram');
    return;
  }

  if (!confirm(`–ü–æ–¥—Ç–≤–µ—Ä–∂–¥–∞–µ—Ç–µ –≥–æ–ª–æ—Å "${choice === YES ? '–ó–ê –æ—Å—Ç–∞–≤–∏—Ç—å' : '–ü–†–û–¢–ò–í'}"?`)) return;

  try {
    const getRes = await fetch(`https://api.github.com/repos/${GITHUB.owner}/${GITHUB.repo}/contents/${GITHUB.path}`, {
      headers: { 'Authorization': `token ${GITHUB.token}` }
    });

    if (!getRes.ok) {
      if (getRes.status === 404) {
        alert('–§–∞–π–ª votes.json –Ω–µ –Ω–∞–π–¥–µ–Ω –≤ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏!\n–°–æ–∑–¥–∞–π—Ç–µ –µ–≥–æ –≤—Ä—É—á–Ω—É—é –Ω–∞ GitHub');
      } else {
        alert(`–û—à–∏–±–∫–∞ –¥–æ—Å—Ç—É–ø–∞ –∫ —Ñ–∞–π–ª—É: ${getRes.status}`);
      }
      return;
    }

    const file = await getRes.json();

    if (!file.content || !file.sha) {
      throw new Error('–ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π –æ—Ç–≤–µ—Ç –æ—Ç GitHub (–Ω–µ—Ç content/sha)');
    }

    let base64Content = file.content.replace(/\s+/g, '');
    let votes = JSON.parse(atob(base64Content));

    if (votes.voters?.[userId]) {
      alert('–í—ã —É–∂–µ –≥–æ–ª–æ—Å–æ–≤–∞–ª–∏!');
      return;
    }

    votes[choice] = (votes[choice] || 0) + 1;
    votes.voters = votes.voters || {};
    votes.voters[userId] = choice;

    const updateRes = await fetch(`https://api.github.com/repos/${GITHUB.owner}/${GITHUB.repo}/contents/${GITHUB.path}`, {
      method: 'PUT',
      headers: {
        'Authorization': `token ${GITHUB.token}`,
        'Content-Type': 'application/json'
      },
      body: JSON.stringify({
        message: `–ì–æ–ª–æ—Å–æ–≤–∞–Ω–∏–µ: +1 ${choice}`,
        content: btoa(JSON.stringify(votes)),
        sha: file.sha,
        branch: 'main'
      })
    });

    if (!updateRes.ok) {
      const errorData = await updateRes.json();
      alert('–û—à–∏–±–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è:\n' + (errorData.message || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞'));
      return;
    }

    alert('–ì–æ–ª–æ—Å —É—á—Ç—ë–Ω! –°–ø–∞—Å–∏–±–æ!');
    loadResults();
    disableButtons();
  } catch (e) {
    console.error('–û—à–∏–±–∫–∞ –≥–æ–ª–æ—Å–æ–≤–∞–Ω–∏—è:', e);
    alert('–ù–µ —É–¥–∞–ª–æ—Å—å —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å –≥–æ–ª–æ—Å\n' + (e.message || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞'));
  }
}

function disableButtons() {
  document.getElementById('vote-yes').disabled = true;
  document.getElementById('vote-no').disabled = true;
}

// –°–æ–±—ã—Ç–∏—è
document.getElementById('vote-yes').onclick = () => vote('yes');
document.getElementById('vote-no').onclick = () => vote('no');

// –ó–∞–ø—É—Å–∫
window.addEventListener('load', () => {
  loadResults();
  updateTimer();
  setInterval(updateTimer, 1000);
});

if (window.Telegram?.WebApp) {
  window.Telegram.WebApp.ready();
  window.Telegram.WebApp.expand();
}

// –Ø–Ω–¥–µ–∫—Å.–ö–∞—Ä—Ç—ã
ymaps.ready(initMap);
function initMap() {
  var myMap = new ymaps.Map("map", {
    center: [43.115, 131.885],
    zoom: 12,
    controls: ['zoomControl', 'fullscreenControl']
  });

  var branches = [
    [[43.119016, 131.907513], "–ß–∏-–§–∞–Ω—å –Ω–∞ –°–∏–±–∏—Ä—Ü–µ–≤–∞", "–ê–≤—Ç–æ–∫–∞—Ñ–µ, —É–ª. –í—Å–µ–≤–æ–ª–æ–¥–∞ –°–∏–±–∏—Ä—Ü–µ–≤–∞, 59, —Å—Ç. 2<br>–ü–Ω‚Äì–í—Å: 10:00 ‚Äì 03:00"],
    [[43.0934415, 131.901757], "–ß–∏-–§–∞–Ω—å –Ω–∞ –ö–∞–ª–∏–Ω–∏–Ω–∞", "–ö–∞—Ñ–µ, —É–ª. –ö–∞–ª–∏–Ω–∏–Ω–∞, 275–∞<br>–ü–Ω‚Äì–í—Å: 10:00 ‚Äì 21:00"],
    [[43.116913, 131.881732], "–ß–∏-–§–∞–Ω—å –Ω–∞ –°–≤–µ—Ç–ª–∞–Ω—Å–∫–æ–π", "–ö–∞—Ñ–µ, —É–ª. –°–≤–µ—Ç–ª–∞–Ω—Å–∫–∞—è, 9–±<br>–ü–Ω‚Äì–í—Å: 10:00 ‚Äì 22:00"],
    [[43.122530, 131.926748], "–ß–∏-–§–∞–Ω—å –Ω–∞ –¢–æ–±–æ–ª—å—Å–∫–æ–π", "–ê–≤—Ç–æ–∫–∞—Ñ–µ, —É–ª. –¢–æ–±–æ–ª—å—Å–∫–∞—è, 10, —Å—Ç. 2<br>–ü–Ω‚Äì–í—Å: 10:00 ‚Äì 00:00"],
    [[43.092003, 131.970610], "–ß–∏-–§–∞–Ω—å –Ω–∞ –î–æ–±—Ä–æ–≤–æ–ª—å—Å–∫–æ–≥–æ", "–ö–∞—Ñ–µ, —É–ª. –î–æ–±—Ä–æ–≤–æ–ª—å—Å–∫–æ–≥–æ, 5–∞ —Å—Ç1<br>–ü–Ω‚Äì–í—Å: 10:00 ‚Äì 23:00"]
  ];

  branches.forEach(function(branch) {
    var placemark = new ymaps.Placemark(branch[0], {
      hintContent: branch[1],
      balloonContent: '<strong>' + branch[1] + '</strong><br>' + branch[2]
    });
    myMap.geoObjects.add(placemark);
  });

  myMap.setBounds(myMap.geoObjects.getBounds(), { checkZoomRange: true });
}
</script>
</body>
</html>
